stages:
  - build
  - deploy

build-dev:
  stage: build
  image: node:16.13.2
  only:
    - develop
  script:
    - npm ci
    - npm run build --mode=development
  artifacts:
    paths:
      - dist/

deploy-dev:
  stage: deploy
  image: registry.gitlab.com/gitlab-org/cloud-deploy/aws-base:latest
  only:
    - develop
  script:
    - bash ./scripts/deploy.sh development

build-stg:
  stage: build
  image: node:16.13.2
  only:
    - /^release\/.*$/
  script:
    - npm ci
    - npm run build --mode=staging
  artifacts:
    paths:
      - dist/

deploy-stg:
  stage: deploy
  image: registry.gitlab.com/gitlab-org/cloud-deploy/aws-base:latest
  only:
    - /^release\/.*$/
  script:
    - bash ./scripts/deploy.sh staging

build-pre-prod:
  stage: build
  image: node:16.13.2
  only:
    - /^hotfix\/.*$/
  script:
    - npm ci
    - npm run build --mode=pre-production
  artifacts:
    paths:
      - dist/

deploy-pre-prod:
  stage: deploy
  image: registry.gitlab.com/gitlab-org/cloud-deploy/aws-base:latest
  only:
    - /^hotfix\/.*$/
  script:
    - bash ./scripts/deploy.sh pre-production

build-prod:
  stage: build
  image: node:16.13.2
  only:
    - main
  script:
    - npm ci
    - npm run build --mode=production
  artifacts:
    paths:
      - dist/

deploy-prod:
  stage: deploy
  image: registry.gitlab.com/gitlab-org/cloud-deploy/aws-base:latest
  only:
    - main
  script:
    - bash ./scripts/deploy.sh production
